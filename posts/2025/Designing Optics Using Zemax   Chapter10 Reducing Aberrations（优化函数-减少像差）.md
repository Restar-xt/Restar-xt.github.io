---
title: Designing Optics Using Zemax Chapter10 Reducing Aberrations（优化函数-减少像差）
tags: [Zemax]
categories: [光设软件基础-Zemax]
date: 2025-10-14
description: 本笔记参考 《Designing Optics Using Zemax》
articleGPT: 在本章中，我们将重点探讨通过OpticStudio的局部优化功能（Optimize > Optimize!）来降低第六至八章中识别的初级像差。需特别说明的是，该手段非全面的镜头性能优化方案。实践中，单纯消减初级像差并不可取——由于实际镜头可能具备大孔径和/或大视场特性，会引发高阶像差。将初级像差归零化处理会阻碍其与高阶像差形成平衡（通常导致成像质量恶化）。
references:
  - title: 《Designing Optics Using Zemax OpticStudio》
  - url: https://ebooks.spiedigitallibrary.org/ebooks/PM/designing-optics-using-zemax-opticstudio/eISBN-9781510668577/10.1117/3.100004
   
---

# 《Designing Optics Using Zemax 》 Chapter10 Reducing Aberrations（优化函数-减少像差）
> **参考书目：**  
> 《Designing Optics Using Zemax OpticStudio》 SPIE Press     &ensp;      Donald O’Shea and Julie Bentley 
>
> **使用软件：**\
> Ansys Zemax OpticStudio 2023 R2.00
>
> **课程概述：**\
> 本书旨在系统阐述使用光学设计软件Zemax OpticStudio®构建光学系统的设计方法。通过该软件平台，本书将完整呈现光学设计流程（从镜头参数定义到公差分析），并辅以详细的操作演示。本书的编排架构可使读者实现以下目标：
> 
> （1）完整重现设计过程中的每个操作步骤（包括生成光学性能分析图的流程）；
> 
> （2）透彻理解各环节在最终设计方案形成中的核心作用。

&emsp;&emsp;在本章中，我们将重点探讨通过OpticStudio的局部优化功能（**Optimize > Optimize!**）来降低第六至八章中识别的初级像差。需特别说明的是，该手段非全面的镜头性能优化方案。实践中，单纯消减初级像差并不可取——由于实际镜头可能具备大孔径和/或大视场特性，会引发高阶像差。将初级像差归零化处理会阻碍其与高阶像差形成平衡（通常导致成像质量恶化）。

## The Merit Function 价值函数/评价函数

### 什么是优化？

所谓优化主要有三个基本的组成：
- **一个初始结构**
- **一组可变参数（半径、厚度、材料等等）**
- **一个价值函数（用于在变量变化即优化过程中，对性能变化进行核算）**

&emsp;&emsp;**优化是在一系列步骤或循环中进行的。在每个循环过程中，允许设计中的变量以较小的增量变化。在每个循环结束后，计算新设计的价值函数值，并与上一个循环的价值函数值进行比较。**

&emsp;&emsp;对于局部优化，OpticStudio采用**主动阻尼最小二乘法**，在初始设计点邻近区域寻找指定评价函数的最小值。随后，设计者需判定该优化结果是否满足设计需求，抑或需要对初始点进行重大修改后重启新一轮优化流程。

&emsp;&emsp;在实际应用中，**价值函数有一个单一的数值，它表示一个光学系统与一组指定目标的接近程度**。价值函数越接近于0，说明光学系统的各项指标与目标设定越接近。

&emsp;&emsp;这些目标可涉及性能参数（如RMS均方根点斑尺寸）、系统约束（如50毫米EFF有效焦距）或制造要求（如透镜最小边厚5毫米）。在OpticStudio中，此类目标以**操作数**的形式定义。**每个操作数设有目标值（通常为零）和权重系数**。评价函数则通过以下方式计算：**首先求出列表中各操作数实际值与目标值之差的平方加权和，再对该加权和取平方根。该定义使理想评价函数值为零。优化算法将通过调整系统参数，使该函数值最小化，最终使其趋近于零。**

### Zemax评价函数编辑器

[![评价函数编辑器](https://free.picui.cn/free/2025/10/14/68ee2ad71995b.png)](https://free.picui.cn/free/2025/10/14/68ee2ad71995b.png)


&emsp;&emsp;上图即为一个评价函数表，注意表头，第一列为Type（蓝色框），使用四个字母表示操作数类型。

&emsp;&emsp;紧接着后面的6列（红色框）用于细化操作数定义。在红色框中，前两个域为整数值，其中第一列为空，第二列Wave下的数字表明了操作数是对哪一个波长进行优化评价。由于多数性能评价类操作数为基于光线的物理量，后面六个域为双精度值（Data1-Data6，Data5、Data6为空），其中$H_{x}$、$H_{y}$、$P_{x}$、$P_{y}$定义了光线参数，指明了操作数是对哪根光线进行优化评价。需特别注意：并非所有操作数均需使用全部数据域（有空白域），当光标置于操作数行时，表头会自动显示该操作数各域的特定含义。

&emsp;&emsp;最后四列（粉色框）：**每个操作数被赋予一个目标值( Target )和一个权重( Weight )，并在Value列下列出操作数的当前值。** 将目标与操作数当前值的差值在所有操作数上平方求和(带权重)，得到价值函数值(显示在MFE的顶部)。最后一列( % Contrib )以百分比的形式列出了每个操作数对总体价值函数的相对贡献。

### 默认评价函数 DMFS

&emsp;&emsp;首次启动评价函数编辑器(MFE)时，界面呈空白状态。典型的评价函数包含数百个操作符。为确保操作效率，OpticStudio通过优化向导（**Optimize>Optimization Wizard**）提供便捷的默认评价函数生成功能，避免了逐项输入的繁琐操作。下图展示了优化向导的参数设置界面，用户可在此配置默认评价函数(DMF)的各项参数。完成设置并应用(Apply)后，向导将在MFE中DMFS行之下生成操作数列表。需特别注意：为实现DMF正常运行，所有用户自定义操作符必须置于该行之上。

[![优化向导](https://free.picui.cn/free/2025/10/14/68ee2988cd43b.png)](https://free.picui.cn/free/2025/10/14/68ee2988cd43b.png)


## 优化实例1：Defocus离焦


&emsp;&emsp;虽然离焦并不能够减小像差，但是在之前的实验中发现，当像平面（评价平面）由近轴像面偏移时，会得到轴向光束截面面积最小的光斑。近轴像面虽是参考基准，但在镜头有像差的情况下，其并不一定是最佳的像面评价位置。

### LDE数据

[![镜头数据](https://free.picui.cn/free/2025/09/22/68d1174e611ca.png)](https://free.picui.cn/free/2025/09/22/68d1174e611ca.png)

&emsp;&emsp;这是之前球差一章中设计的单透镜模型，其中EPD=20mm，波长为d光。与之前不同的是，**要把透镜第二面（surface3）的厚度设置为变量（M>V）。**

[![设置第二面厚度为变量](https://free.picui.cn/free/2025/10/14/68ee298892b09.png)](https://free.picui.cn/free/2025/10/14/68ee298892b09.png)

### 设置评价函数 

&emsp;&emsp;若立即尝试优化该透镜，将无任何效果，原因在于没有定义评价函数。打开优化向导（Optimize>Optimization Wizard），将"Image Quality"由Wavefront波前优化改为Spot点列图优化后点击确定。

[![MFE数据](https://free.picui.cn/free/2025/10/14/68ee2988821e0.png)](https://free.picui.cn/free/2025/10/14/68ee2988821e0.png)

&emsp;&emsp;如上图，DMF显示了三个光瞳位置（Px: 0.336、0.707、0.942）对应的两组横向光线操作数（TRCX与TRCY），共形成六个操作数。起始评价函数（MF）值为0.4602，其中最大贡献源（79.9%）来自光瞳边缘射线（Px=0.942）的TRCX操作数。

::: info
**关于TRCX、TRCY操作数的定义：**

| 参数名 | 说明 |
| :--- | :--- |
| TRCX | 像空间测得的X方向垂轴像差，参考质心。 |
| TRCY | 像空间测得的Y方向垂轴像差，参考质心。 |

:::

&emsp;&emsp;一根光线用$(H_{x},H_{y},P_{x},P_{y})$进行表示，那么根据上述操作数的定义不难理解为什么最大贡献源来自光瞳边缘射线（Px=0.942）的TRCX操作数。对于$(0,0,0.942,0)$来说，按照TRCX的定义，测的是x方向上的垂轴像差，很显然，这条光线在瞳面的坐标为$(0.942,0)$，与坐标原点$(0,0)$在x方向上偏离较大，是球差的最大贡献源。而TRCY测的是y方向上的垂轴像差，很显然在y方向上，其纵坐标为0，这条光线并没有在这个方向上产生垂轴像差，故而其对应的Value和Contrib均为0。（PS:这里千万不要与旋转对称性所困扰，要注意在同一条光线下两个操作数的区别）

### 优化

&emsp;&emsp;**Optimize > Optimize!** 开始优化，局部优化窗口回弹出，局部优化窗口会列出激活算法、变量数、起始评价函数值、当前评价函数值等等。

[![局部优化窗口](https://free.picui.cn/free/2025/10/14/68ee269839804.png)](https://free.picui.cn/free/2025/10/14/68ee269839804.png)

&emsp;&emsp;单击Start即可开始优化，优化后完毕后，局部优化窗口会更新当前评价函数数值，可见优化后的评价函数数值降为0.153，提升3倍左右。

[![优化一轮后的局部优化窗口](https://free.picui.cn/free/2025/10/14/68ee269839041.png)](https://free.picui.cn/free/2025/10/14/68ee269839041.png)

[![优化后的LDE数据](https://youke1.picui.cn/s1/2025/10/14/68edcd741c317.png)](https://youke1.picui.cn/s1/2025/10/14/68edcd741c317.png)

| [![](https://free.picui.cn/free/2025/10/14/68ee26ecd2762.png)](https://free.picui.cn/free/2025/10/14/68ee26ecd2762.png)|[![](https://free.picui.cn/free/2025/10/14/68ee26e99cba7.png)](https://free.picui.cn/free/2025/10/14/68ee26e99cba7.png)|
|:--:|:--:|
| RMS:654.934mm | RMS:218.923mm |

## 优化实例2：Reducing Spherical Aberration 减少球差

&emsp;&emsp;透镜形状会影响球差的大小，那什么样的形状球差最小呢？这个问题也可以通过Zemax的自动优化解决。

### LDE数据

&emsp;&emsp;即上文优化过后的单透镜。

### 原始球差系数

```
THIRD
Primary Wavelength: 0.5876 um
Surf TSPH TTCO TAST TPFC TSFC TTFC TDIS TAXC TLAC
STO   -0.00325  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000
  2   -1.13333   0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000   0.00000  -0.00000
IMA   -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000  -0.00000
TOT   -1.13658   0.00000   0.00000   0.00000   0.00000   0.00000   0.00000   0.00000   0.00000
```

### 优化

&emsp;&emsp;虽然在Zemax中可以改变几乎每一个透镜参数(如半径、厚度、材料等)，但目前我们将简单地通过改变其两个曲率半径来优化单透镜形状。在LDE中，将每个半径旁边的Solve Type框从Fixed改为Variable 注意：为了找到新透镜形状的最佳像面位置，像面距离仍然允许变化。

[![LDE 数据](https://youke1.picui.cn/s1/2025/10/14/68eddad33e15a.png)](https://youke1.picui.cn/s1/2025/10/14/68eddad33e15a.png)

&emsp;&emsp;该优化过程仍然可以使用刚刚的评价函数，但是如果两个曲率都允许变化，那么焦距显然会被轻松改变。那么，如何在保持焦距一定的情况下使得透镜形状发生变化呢？我们就需要引入一个用户输入的操作数(约束)，以便在优化过程中保持50mm的有效焦距，即EFFL。

[![新的评价函数](https://youke1.picui.cn/s1/2025/10/14/68eddd68586cb.png)](https://youke1.picui.cn/s1/2025/10/14/68eddd68586cb.png)

&emsp;&emsp;开始优化，优化后的结果如下：

[![优化后的评价函数](https://youke1.picui.cn/s1/2025/10/14/68eddf1530584.png)](https://youke1.picui.cn/s1/2025/10/14/68eddf1530584.png)

&emsp;&emsp;评价函数值降低到0.047，相比0.153，说明优化后性能提升3倍左右。虽然焦距为50.001，但是对评价函数的贡献值约为0.0003，非常小，若想继续优化，可以适当提高EFFL的权重，这里将权重从1改到10，然后开始优化。

[![更改EFFL权重](https://youke1.picui.cn/s1/2025/10/14/68ede0c26cfec.png)](https://youke1.picui.cn/s1/2025/10/14/68ede0c26cfec.png)

&emsp;&emsp;观察上图，不难发现，在更改权重后，评价函数值增大，但是焦距对评价函数的贡献值明显变大，从原来的0.0003增大至0.031。点击优化，优化过后的镜头数据如下：

[![优化后的LDE数据](https://youke1.picui.cn/s1/2025/10/14/68ede23210a29.png)](https://youke1.picui.cn/s1/2025/10/14/68ede23210a29.png)

| [![](https://youke1.picui.cn/s1/2025/10/14/68edce6f10164.png)](https://youke1.picui.cn/s1/2025/10/14/68edce6f10164.png)|[![](https://youke1.picui.cn/s1/2025/10/14/68ede3689c62b.png)](https://youke1.picui.cn/s1/2025/10/14/68ede3689c62b.png)|
|:--:|:--:|
| 原始结构最佳像面RMS:218.923mm | 优化形状后的最佳像面RMS:72.911mm |


```
THIRD
Primary Wavelength: 0.5876 um
Surf TSPH TTCO TAST TPFC TSFC TTFC TDIS TAXC TLAC
STO   -0.20536  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000
  2   -0.19250   0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000   0.00000  -0.00000
IMA   -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000  -0.00000
TOT   -0.39786   0.00000   0.00000   0.00000   0.00000   0.00000   0.00000   0.00000   0.00000

```

&emsp;&emsp;球差系数由原来的-1.13降低到-0.39（数值绝对值大小）。

## 优化实例3：Reducing Coma 减少彗差

### Lnes Bending 弯曲透镜形状

&emsp;&emsp;在之前彗差一章中，我们发现反转透镜会使其彗差下降6倍左右，考虑到反转透镜和透镜本身两种形状是透镜众多形状中的数据点，因此推测改变透镜形状也可以校正彗差。

&emsp;&emsp;恢复单透镜最原始的结构，增添离轴场点0.7°、1°，尝试优化其至零彗差。首先，**明确变量**，即透镜的前后曲率半径以及像面位置；其次，**增添EFFL操作数**使之保持50mm有效焦距；最后，查阅文档，**寻找优化彗差的操作数（COMA）**。PS：要打开光线瞄准。

- **原始像差系数**
```
THIRD
Primary Wavelength: 0.5876 um
Surf TSPH TTCO TAST TPFC TSFC TTFC TDIS TAXC TLAC
STO   -0.00325  -0.00204  -0.00029  -0.00022  -0.00036  -0.00064  -0.00008  -0.00000  -0.00000
  2   -1.13333   0.09968  -0.00195  -0.00080  -0.00177  -0.00372   0.00005   0.00000  -0.00000
IMA   -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000
TOT   -1.13658   0.09764  -0.00223  -0.00102  -0.00213  -0.00437  -0.00002   0.00000   0.00000
```

- **评价函数**

[![评价函数](https://free.picui.cn/free/2025/10/14/68ee269bec595.png)](https://free.picui.cn/free/2025/10/14/68ee269bec595.png)

&emsp;&emsp;从上图还能看出来之前提到的关于操作数8个定义参数。发现COMA的第一个整数域启用即Surf表面，Surf指定为0表明该操作数优化的是系统总的彗差。这也进一步说明了之前提到的，有的操作数不需要定义8个数据，存在缺省。

- **优化过程**

&emsp;&emsp;按照上述评价函数优化一次后，评价函数值下降至0.0448，但是EFFL、COMA仍不符合要求，提升权重继续优化。

[![一次优化](https://free.picui.cn/free/2025/10/14/68ee269cc2c37.png)](https://free.picui.cn/free/2025/10/14/68ee269cc2c37.png)

&emsp;&emsp;将EFFL权重提升到10，COMA权重提升到50，再次优化。

[![二次优化](https://free.picui.cn/free/2025/10/14/68ee269dcb40e.png)](https://free.picui.cn/free/2025/10/14/68ee269dcb40e.png)

&emsp;&emsp;评价函数值降低至0.0158，COMA数值降低到$10^{-6}$量级，焦距符合要求。THIRD.zpl运行结果如下：

```
THIRD
Primary Wavelength: 0.5876 um
Surf TSPH TTCO TAST TPFC TSFC TTFC TDIS TAXC TLAC
STO   -0.23416  -0.03536  -0.00119  -0.00090  -0.00149  -0.00268  -0.00008  -0.00000  -0.00000
  2   -0.16576   0.03536  -0.00168  -0.00011  -0.00095  -0.00263   0.00007   0.00000  -0.00000
IMA   -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000  -0.00000
TOT   -0.39992   0.00000  -0.00286  -0.00101  -0.00244  -0.00531  -0.00001   0.00000   0.00000
```

[![最终的LDE数据](https://free.picui.cn/free/2025/10/14/68ee277784a53.png)](https://free.picui.cn/free/2025/10/14/68ee277784a53.png)

[![初始点列图.png](https://free.picui.cn/free/2025/10/14/68ee26e9a8cab.png)](https://free.picui.cn/free/2025/10/14/68ee26e9a8cab.png)

[![最终点列图.png](https://free.picui.cn/free/2025/10/14/68ee26e98b483.png)](https://free.picui.cn/free/2025/10/14/68ee26e98b483.png)

&emsp;&emsp;从上面的两幅点列图可以明显看到优化后性能的提升，初始点列图还可以观察到彗差带来的影响，而优化后的点列图明显看不到彗差。另外优化后点列图光斑RMS均在73左右，三个视场RMS几乎不变，说明彗差已被尽可能消除，只剩下球差（而球差不随视场变化而变化）；初始点列图光斑RMS约在657mm。

### Stop shifting 光阑移动

&emsp;&emsp;**移动光阑也可以减少彗差。** 以下面的透镜为例说明这一结论。

[![LDE数据](https://free.picui.cn/free/2025/10/14/68ee277784a53.png)](https://free.picui.cn/free/2025/10/14/68ee277784a53.png)

&emsp;&emsp;EPD=4mm；视场取0°、7°、10°；波长为d光。

[![切面图.png](https://free.picui.cn/free/2025/10/14/68ee26e930b0e.png)](https://free.picui.cn/free/2025/10/14/68ee26e930b0e.png)

&emsp;&emsp;原始像差系数如下，其中TTCO彗差系数为0.07378。

```
THIRD
Primary Wavelength: 0.5876 um
Surf TSPH TTCO TAST TPFC TSFC TTFC TDIS TAXC TLAC
  1    0.00000   0.00000   0.00000   0.00000   0.00000   0.00000  -0.00000  -0.00000  -0.00000
STO    0.00000   0.00000   0.00000   0.00000   0.00000   0.00000  -0.00000  -0.00000  -0.00000
  3    0.00012  -0.00230   0.00973   0.00738   0.01224   0.02196  -0.07748   0.00000  -0.00000
  4   -0.02474   0.07609  -0.05199  -0.02748  -0.05348  -0.10547   0.05482   0.00000  -0.00000
IMA   -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000
TOT   -0.02462   0.07378  -0.04227  -0.02011  -0.04124  -0.08351  -0.02267   0.00000   0.00000
```

&emsp;&emsp;将光阑手动调整到透镜前表面7.6mm处，观察像差系数变化。

```
THIRD
Primary Wavelength: 0.5876 um
Surf TSPH TTCO TAST TPFC TSFC TTFC TDIS TAXC TLAC
  1    0.00000   0.00000   0.00000   0.00000   0.00000   0.00000  -0.00000  -0.00000  -0.00000
STO    0.00000   0.00000   0.00000   0.00000   0.00000   0.00000  -0.00000  -0.00000  -0.00000
  3    0.00012  -0.00206   0.00778   0.00738   0.01126   0.01904  -0.06377   0.00000  -0.00000
  4   -0.02474   0.02635  -0.00624  -0.02748  -0.03060  -0.03684   0.01086   0.00000  -0.00000
IMA   -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000
TOT   -0.02462   0.02429   0.00154  -0.02011  -0.01934  -0.01780  -0.05290   0.00000   0.00000
```

&emsp;&emsp;彗差(TTCO)从0.0738降至0.0243，降幅达三倍；子午场曲(TTFC)更是减小至原值的四分之一以下。需注意的是，球差(TSPH)和匹兹凡场曲(TPFC)不随光阑位移而变化。

&emsp;&emsp;早期的照相机镜头是由一个简单的单镜头组成的，在镜头前方有一段距离处有一个光阑，因为它在更宽的视场角范围内比用透镜前表面作为光阑的简单单镜头有更好的校正效果。正因如此，这样的透镜被称为**景观透镜/风景镜头**。

&emsp;&emsp;现在使用Zemax自动优化实现零彗差。只需要将光阑厚度设置为变量，其余不变。打开优化向导，并将Wvefront修改为Spot，使用默认评价函数。最后，手动插入COMA彗差操作数。

[![MFE数据](https://free.picui.cn/free/2025/10/14/68ee32243d1fc.png)](https://free.picui.cn/free/2025/10/14/68ee32243d1fc.png)

&emsp;&emsp;优化后的像差系数结果如下:

```
THIRD
Primary Wavelength: 0.5876 um
Surf TSPH TTCO TAST TPFC TSFC TTFC TDIS TAXC TLAC
  1    0.00000   0.00000   0.00000   0.00000   0.00000   0.00000  -0.00000  -0.00000  -0.00000
STO    0.00000   0.00000   0.00000   0.00000   0.00000   0.00000  -0.00000  -0.00000  -0.00000
  3    0.00012  -0.00194   0.00690   0.00738   0.01082   0.01772  -0.05772   0.00000  -0.00000
  4   -0.02474   0.00194  -0.00003  -0.02748  -0.02750  -0.02753   0.00072   0.00000  -0.00000
IMA   -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000  -0.00000   0.00000
TOT   -0.02462   0.00000   0.00686  -0.02011  -0.01667  -0.00981  -0.05700   0.00000   0.00000
```

### Flipping the lens 翻转镜头

&emsp;&emsp;略。

## Reducing Distortion 减少畸变

### 一个对比

&emsp;&emsp;



